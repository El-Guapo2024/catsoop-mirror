TODOs:

* is this too ugly as-is?  passing around the connection is a pain: need comments

* load testing?
